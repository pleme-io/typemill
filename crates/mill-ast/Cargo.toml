[package]
name = "mill-ast"
edition = "2021"
description = "AST parsing and transformation for Codeflow Buddy"
license = "MIT"

[dependencies]
mill-foundation = { path = "../mill-foundation" }
mill-plugin-api = { path = "../mill-plugin-api" }
mill-lang-common = { path = "../../crates/mill-lang-common" }
serde = { workspace = true }
serde_json = { workspace = true }
thiserror = { workspace = true }
chrono = { version = "0.4", features = ["serde"] }
async-trait = { workspace = true }
# LSP types for refactoring integration
lsp-types = "0.97"
# Enhanced parsing with regex (kept for fallback)
regex = "1.10"
# Rust AST parsing
syn = { version = "2.0", features = ["full", "extra-traits", "visit"] }
quote = "1.0"
# Additional utilities
petgraph = "0.8" # For dependency graph analysis
pathdiff = "0.2" # For calculating relative paths
tokio = { workspace = true } # For async file operations in import_updater
ignore = "0.4" # For .gitignore-aware file walking
futures = { workspace = true }
tracing = { workspace = true } # For logging in import_updater
dashmap = { workspace = true } # For thread-safe concurrent caching
toml_edit = "0.24" # For parsing and modifying Cargo.toml files
mill-config = { path = "../mill-config" }

[features]
# Language features are preserved for backward compatibility but do not enable dependencies
# mill-ast now uses capability traits from mill-plugin-api instead of direct plugin dependencies
default = ["lang-markdown", "lang-python", "lang-rust", "lang-typescript"]
lang-rust = []
lang-typescript = []
lang-markdown = []
lang-python = []

[dev-dependencies]
tempfile = "3.0"
mill-lang-rust = { path = "../../languages/mill-lang-rust", default-features = false }
mill-lang-typescript = { path = "../../languages/mill-lang-typescript", default-features = false }
