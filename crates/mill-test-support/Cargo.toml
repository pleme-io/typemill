[package]
name = "mill-test-support"
version = "1.0.0-rc4"
edition = "2021"
license.workspace = true
publish = false

[dependencies]
tokio = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
tempfile = { workspace = true }
async-trait = { workspace = true }
uuid = { workspace = true }
mockall = { workspace = true }
shellexpand = "3.1"
chrono = { version = "0.4", features = ["serde"] }
libc = "0.2"
anyhow = { workspace = true }
mill-foundation = { path = "../mill-foundation" }
mill-plugin-api = { path = "../mill-plugin-api" }
mill-services = { path = "../mill-services", default-features = false }

# Benchmark dependencies (merged from cb-bench)
mill-server = { path = "../mill-server", default-features = false }
simd-json = "0.16"
mill-plugin-system = { path = "../mill-plugin-system", default-features = false, features = ["runtime"] }
mill-config = { path = "../mill-config" }
mill-ast = { path = "../mill-ast", default-features = false }
mill-handlers = { path = "../mill-handlers", default-features = false, features = ["refactor-all"] }

# Plugin bundle - needs to be a regular dependency since we use it in lib code (plugin_discovery.rs)
mill-plugin-bundle = { path = "../mill-plugin-bundle", features = ["lang-gitignore", "lang-markdown", "lang-python", "lang-rust", "lang-toml", "lang-typescript", "lang-yaml"] }

[dev-dependencies]
criterion = { version = "0.5", features = ["html_reports", "async_tokio"] }

# Individual language plugins as dev-dependencies for extern crate declarations
# These must match the features enabled in mill-plugin-bundle above
mill-lang-python = { path = "../../languages/mill-lang-python" }
mill-lang-rust = { path = "../../languages/mill-lang-rust" }
mill-lang-typescript = { path = "../../languages/mill-lang-typescript" }

# Benchmarks
[[bench]]
name = "serialization_benchmark"
harness = false
