[package]
name = "mill-test-support"
version = "1.0.0-rc4"
edition = "2021"
license.workspace = true
publish = false

[dependencies]
tokio = { workspace = true }
serde = { workspace = true }
serde_json = { workspace = true }
tempfile = { workspace = true }
async-trait = { workspace = true }
uuid = { workspace = true }
mockall = { workspace = true }
shellexpand = "3.1"
chrono = { version = "0.4", features = ["serde"] }
libc = "0.2"
mill-foundation = { path = "../mill-foundation" }
mill-plugin-api = { path = "../mill-plugin-api" }
mill-services = { path = "../mill-services", default-features = false }

# Benchmark dependencies (merged from cb-bench)
mill-server = { path = "../mill-server", default-features = false }
simd-json = "0.16"
mill-plugin-system = { path = "../mill-plugin-system", default-features = false, features = ["runtime"] }
mill-config = { path = "../mill-config" }
mill-ast = { path = "../mill-ast", default-features = false }
mill-handlers = { path = "../mill-handlers", default-features = false, features = ["refactor-all"] }

[dev-dependencies]
criterion = { version = "0.5", features = ["html_reports", "async_tokio"] }

# Plugin bundle - provides all language plugins via auto-discovery
# Linked via extern crate declaration in test modules
# Note: lang-csharp temporarily excluded due to tree-sitter 0.20 vs 0.25 version conflict
mill-plugin-bundle = { path = "../mill-plugin-bundle", features = ["lang-rust", "lang-typescript", "lang-python", "lang-java", "lang-go", "lang-swift", "lang-c", "lang-cpp"] }

# Individual language plugins as dev-dependencies for extern crate declarations
# These must match the features enabled in mill-plugin-bundle above
mill-lang-c = { path = "../../languages/mill-lang-c" }
mill-lang-go = { path = "../../languages/mill-lang-go" }
mill-lang-java = { path = "../../languages/mill-lang-java" }
mill-lang-python = { path = "../../languages/mill-lang-python" }
mill-lang-rust = { path = "../../languages/mill-lang-rust" }
mill-lang-swift = { path = "../../languages/mill-lang-swift" }
mill-lang-typescript = { path = "../../languages/mill-lang-typescript" }
mill-lang-cpp = { path = "../../languages/mill-lang-cpp" }

# Benchmarks
[[bench]]
name = "serialization_benchmark"
harness = false
