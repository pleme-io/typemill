[profile.default]
# Default profile for local development
retries = 0
fail-fast = false
# Note: Tests should be run with --release flag for 2-5x speedup (regex optimizations)
# Example: cargo nextest run --workspace --release

# E2E tests spawn multiple LSP servers which compete for resources.
# Limit parallelism for E2E tests to avoid resource exhaustion.
# Non-E2E tests can still run at full parallelism.
[[profile.default.overrides]]
filter = 'package(e2e)'
threads-required = 4  # Each E2E test counts as 4 threads worth of work
slow-timeout = { period = "180s", terminate-after = 2 }

[[profile.default.overrides]]
filter = 'package(mill) & test(e2e)'
threads-required = 4
slow-timeout = { period = "180s", terminate-after = 2 }

[profile.ci]
# CI profile for GitHub Actions
retries = 2
fail-fast = false
status-level = "all"
final-status-level = "fail"
# Note: CI runs tests with --release flag for 2-5x speedup (see .github/workflows/ci.yml)

# Test threads: Use available parallelism
test-threads = "num-cpus"

[[profile.ci.overrides]]
filter = 'package(e2e)'
threads-required = 4  # Each E2E test counts as 4 threads worth of work
slow-timeout = { period = "180s", terminate-after = 2 }

[[profile.ci.overrides]]
filter = 'package(mill) & test(e2e)'
threads-required = 4
slow-timeout = { period = "180s", terminate-after = 2 }
